<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Parts Downloader د</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, rgb(0, 18, 10) 0%, rgb(0, 8, 9) 100%);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #f0f0f0;
    }
    .container { max-width: 1000px; width: 100%; }
    .main-header { text-align: center; margin-bottom: 20px; }
    .parts-grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(250px,1fr)); gap: 15px; }
    .part-card { background: rgba(255,255,255,0.08); padding: 15px; border-radius: 12px; }
    .download-btn { background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; }
    .reset-btn { background: #ff5252; color: #fff; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; }
    .admin-btn { background: #ffc107; color: black; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; }
    .actions { display: flex; gap: 10px; justify-content: center; margin: 20px 0; }
    #passwordPrompt,#adminPanel { display: none; margin: 15px auto; background: rgba(255,255,255,0.08); padding: 15px; border-radius: 12px; }
    input { padding: 6px; margin: 5px 0; border-radius: 6px; border: 1px solid #ccc; width: 90%; }
    .add-btn { background: #28a745; color:#fff; padding: 8px 14px; border:none; border-radius:6px; cursor: pointer; }
    .edit-btn { background: #ffc107; padding: 5px 10px; border:none; border-radius:6px; cursor: pointer; }
    .delete-btn { background: #dc3545; color:#fff; padding: 5px 10px; border:none; border-radius:6px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="container">
    <header class="main-header">
      <h1>🗂️ مركز تحميل البارتات</h1>
    </header>

    <main>
      <div class="parts-grid" id="partsContainer"></div>

      <div class="actions">
        <button id="resetAllBtn" class="reset-btn">إعادة تعيين الكل</button>
        <button class="admin-btn" onclick="showLogin()">🔑 دخول الأدمن</button>
      </div>

      <div id="passwordPrompt">
        <input type="password" id="adminPassword" placeholder="ادخل كلمة المرور">
        <button onclick="checkPassword()">دخول</button>
      </div>

      <div id="adminPanel">
        <h2>لوحة الأدمن</h2>
        <input type="text" id="partName" placeholder="اسم البارت">
        <input type="text" id="partSize" placeholder="الحجم (مثال: 9.77 GB)">
        <input type="text" id="partURL" placeholder="الرابط">
        <button class="add-btn" onclick="addPart()">➕ إضافة بارت</button>
        <div id="adminPartsList"></div>
      </div>
    </main>
  </div>

  <script>
    const BIN_URL = "https://json.extendsclass.com/bin/374fbe8426c4";
    const SECURITY_KEY = ""; // إذا ضفت Security Key من الموقع حطه هنا
    const encodedPassword = "YWhxaWFid28="; // ahqiabwo

    let partsData = [];

    // تحميل البيانات من JSON Bin
    async function loadParts() {
      try {
        const res = await fetch(BIN_URL);
        partsData = await res.json();
        renderParts();
      } catch (err) {
        console.error("خطأ بجلب البيانات:", err);
      }
    }

    // حفظ التغييرات في JSON Bin
    async function saveParts() {
      try {
        await fetch(BIN_URL, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            "Security-key": SECURITY_KEY
          },
          body: JSON.stringify(partsData)
        });
      } catch (err) {
        console.error("خطأ بالحفظ:", err);
      }
    }

    // عرض البارتات
    function renderParts() {
      const container = document.getElementById("partsContainer");
      container.innerHTML = "";
      partsData.forEach((part, i) => {
        const card = document.createElement("div");
        card.className = "part-card";
        card.innerHTML = `
          <h3>${part.name}</h3>
          <p>الحجم: ${part.size}</p>
          <button class="download-btn" onclick="window.open('${part.url}','_blank')">⬇️ تحميل</button>
        `;
        container.appendChild(card);
      });
      renderAdminParts();
    }

    function showLogin() {
      document.getElementById("passwordPrompt").style.display = "block";
    }

    function checkPassword() {
      const input = document.getElementById("adminPassword").value;
      if (input === atob(encodedPassword)) {
        document.getElementById("adminPanel").style.display = "block";
        document.getElementById("passwordPrompt").style.display = "none";
      } else alert("❌ كلمة المرور خاطئة");
    }

    async function addPart() {
      const name = document.getElementById("partName").value;
      const size = document.getElementById("partSize").value;
      const url = document.getElementById("partURL").value;
      if (!name || !size || !url) return alert("⚠️ أدخل كل الحقول");
      partsData.push({ id: "part" + Date.now(), name, size, url });
      await saveParts();
      renderParts();
    }

    function renderAdminParts() {
      const adminList = document.getElementById("adminPartsList");
      adminList.innerHTML = "";
      partsData.forEach((p,i)=>{
        const div = document.createElement("div");
        div.innerHTML = `<b>${p.name}</b> - ${p.size}
          <button class="edit-btn" onclick="editPart(${i})">تعديل</button>
          <button class="delete-btn" onclick="deletePart(${i})">حذف</button>`;
        adminList.appendChild(div);
      });
    }

    async function editPart(index) {
      const p = partsData[index];
      const newName = prompt("اسم البارت:", p.name) || p.name;
      const newSize = prompt("الحجم:", p.size) || p.size;
      const newUrl = prompt("الرابط:", p.url) || p.url;
      partsData[index] = {...p, name:newName, size:newSize, url:newUrl};
      await saveParts();
      renderParts();
    }

    async function deletePart(index) {
      if (confirm("هل تريد حذف هذا البارت؟")) {
        partsData.splice(index,1);
        await saveParts();
        renderParts();
      }
    }

    document.getElementById("resetAllBtn").onclick = async () => {
      if (confirm("هل تريد إعادة تعيين جميع البارتات؟")) {
        partsData = [];
        await saveParts();
        renderParts();
      }
    };

    loadParts();
  </script>
</body>
</html>
